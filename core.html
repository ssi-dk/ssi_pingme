<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Global static vars – ssi_pingme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ae44de7e3b26b230a7801128389852ee.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Global static vars – ssi_pingme">
<meta property="og:description" content="TODO">
<meta property="og:site_name" content="ssi_pingme">
<meta name="twitter:title" content="Global static vars – ssi_pingme">
<meta name="twitter:description" content="TODO">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ssi_pingme</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./core.html">Global static vars</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ssi_pingme</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Global static vars</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pingme_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Additional Learning Resources</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_pingme_services.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02_pingme_services.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pingme_api.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pingme API</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup_logging" id="toc-setup_logging" class="nav-link active" data-scroll-target="#setup_logging">setup_logging</a></li>
  <li><a href="#settings" id="toc-settings" class="nav-link" data-scroll-target="#settings">Settings</a></li>
  <li><a href="#dev-mode" id="toc-dev-mode" class="nav-link" data-scroll-target="#dev-mode">Dev mode</a></li>
  <li><a href="#core" id="toc-core" class="nav-link" data-scroll-target="#core">Core</a>
  <ul class="collapse">
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries">Libraries</a></li>
  <li><a href="#config" id="toc-config" class="nav-link" data-scroll-target="#config">Config</a>
  <ul class="collapse">
  <li><a href="#set-env-variables" id="toc-set-env-variables" class="nav-link" data-scroll-target="#set-env-variables">set env variables</a></li>
  <li><a href="#set_env_variables" id="toc-set_env_variables" class="nav-link" data-scroll-target="#set_env_variables">set_env_variables</a></li>
  <li><a href="#get-config" id="toc-get-config" class="nav-link" data-scroll-target="#get-config">get config</a></li>
  <li><a href="#get_config" id="toc-get_config" class="nav-link" data-scroll-target="#get_config">get_config</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  <li><a href="#show-project-env-vars" id="toc-show-project-env-vars" class="nav-link" data-scroll-target="#show-project-env-vars">show project env vars</a></li>
  <li><a href="#show_project_env_vars" id="toc-show_project_env_vars" class="nav-link" data-scroll-target="#show_project_env_vars">show_project_env_vars</a></li>
  <li><a href="#tool_is_present" id="toc-tool_is_present" class="nav-link" data-scroll-target="#tool_is_present">tool_is_present</a></li>
  <li><a href="#tools_are_present" id="toc-tools_are_present" class="nav-link" data-scroll-target="#tools_are_present">tools_are_present</a></li>
  </ul></li>
  <li><a href="#get_samplesheet" id="toc-get_samplesheet" class="nav-link" data-scroll-target="#get_samplesheet">get_samplesheet</a>
  <ul class="collapse">
  <li><a href="#get_samplesheet-1" id="toc-get_samplesheet-1" class="nav-link" data-scroll-target="#get_samplesheet-1">get_samplesheet</a></li>
  <li><a href="#samplesheetconfig" id="toc-samplesheetconfig" class="nav-link" data-scroll-target="#samplesheetconfig">SamplesheetConfig</a></li>
  <li><a href="#hello_world" id="toc-hello_world" class="nav-link" data-scroll-target="#hello_world">hello_world</a></li>
  <li><a href="#cli" id="toc-cli" class="nav-link" data-scroll-target="#cli">cli</a></li>
  <li><a href="#execute_job" id="toc-execute_job" class="nav-link" data-scroll-target="#execute_job">execute_job</a></li>
  <li><a href="#create_bash_script" id="toc-create_bash_script" class="nav-link" data-scroll-target="#create_bash_script">create_bash_script</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/$GIT_USER_NAME/pingme/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Global static vars</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>For help with the Markdown language, see <a href="https://www.markdownguide.org/basic-syntax/">this guide</a>.</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L62" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="setup_logging" class="level3">
<h3 class="anchored" data-anchor-id="setup_logging">setup_logging</h3>
<blockquote class="blockquote">
<pre><code> setup_logging (log_level=None)</code></pre>
</blockquote>
<p><em>Configure logging for the application</em></p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L37" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="settings" class="level3">
<h3 class="anchored" data-anchor-id="settings">Settings</h3>
<blockquote class="blockquote">
<pre><code> Settings (_case_sensitive:bool|None=None,
           _nested_model_default_partial_update:bool|None=None,
           _env_prefix:str|None=None, _env_file:DotenvType|None=Path('.'),
           _env_file_encoding:str|None=None,
           _env_ignore_empty:bool|None=None,
           _env_nested_delimiter:str|None=None,
           _env_nested_max_split:int|None=None,
           _env_parse_none_str:str|None=None,
           _env_parse_enums:bool|None=None, _cli_prog_name:str|None=None,
           _cli_parse_args:bool|list[str]|tuple[str,...]|None=None,
           _cli_settings_source:CliSettingsSource[Any]|None=None,
           _cli_parse_none_str:str|None=None,
           _cli_hide_none_type:bool|None=None,
           _cli_avoid_json:bool|None=None,
           _cli_enforce_required:bool|None=None,
           _cli_use_class_docs_for_groups:bool|None=None,
           _cli_exit_on_error:bool|None=None, _cli_prefix:str|None=None,
           _cli_flag_prefix_char:str|None=None,
           _cli_implicit_flags:bool|None=None,
           _cli_ignore_unknown_args:bool|None=None,
           _cli_kebab_case:bool|None=None,
           _secrets_dir:PathType|None=None, app_name:str='PingMe',
           config_file:str='')</code></pre>
</blockquote>
<p><em>Base settings class for the package, primarily to gain config_file for dev mode through pydantic</em></p>
</section>
<section id="dev-mode" class="level1">
<h1>Dev mode</h1>
<p>If you’re developing this versus running this, you’ll have access to slightly different things. Notable the nbdev functions are only for development and not for runtime. This matters for items such as the config. So we need to detect if you are in dev mode or not and the code has to adjust accordingly. Notice that this section is not exported so will only work in the notebook and not in the module.</p>
<div id="cell-6" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This section uses nbdev functions so should not be exported as it's for dev purposes</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> DEV_MODE:</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    PACKAGE_DIR <span class="op">=</span> nbdev.config.get_config(cfg_name<span class="op">=</span><span class="st">"settings.ini"</span>, path<span class="op">=</span>os.getcwd())[</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"lib_path"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    ]  <span class="co"># the library is the package of course</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    PROJECT_DIR <span class="op">=</span> nbdev.config.get_config(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        cfg_name<span class="op">=</span><span class="st">"settings.ini"</span>, path<span class="op">=</span>os.getcwd()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    ).config_path  <span class="co"># the default location of nbdev config file (settings.ini)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="core" class="level1">
<h1>Core</h1>
<p>A module which contains common functions to be used by other modules. Those that exist in the template are meant to be common functions we can use against multiple packages.</p>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<p>Currently all libraries included are listed at the top and calls to them are also made in the block of code that uses them. This is for readability and the performance hit of the import is negligible.</p>
</section>
<section id="config" class="level2">
<h2 class="anchored" data-anchor-id="config">Config</h2>
<p>Our config file holds all program and user specific variables. This is a good practice to follow as it allows us to easily change variables without having to change code. It also allows us to easily change variables based on the environment we are running in. For example, we may want to run a program in a test environment with a different database than we would in production. This is also a good practice to follow as it allows us to easily change variables without having to change code. It also allows us to easily change variables based on the environment we are running in. For example, we may want to run a program in a test environment with a different database than we would in production.</p>
<p>Configuration is templated to rely on environment (ENV) variables. A default ENV config is provided in <code>./config/config.default.env</code> and more advanced data structures are supported in <code>./config/config.default.yaml</code>. The <code>.yaml</code> file is meant to represent what your program actually works with and the <code>.env</code> file options the user can change at run time.</p>
<p>Make sure you know the priority of variables and check on them when debugging your code. Also ensure that your yaml file is referenced appropriately in the <code>.env</code> file.</p>
<p>When in use there’s an expectation you’ll have multiple config files for different use cases e.g.&nbsp;development, production environment for different paths, etc.</p>
<section id="set-env-variables" class="level3">
<h3 class="anchored" data-anchor-id="set-env-variables">set env variables</h3>
<p>A helper function for getting your config values, this will set the environment variables with the provided <code>.env</code> values. If you’re missing values it’ll ensure they’re loaded in with the defaults file.</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L121" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="set_env_variables" class="level3">
<h3 class="anchored" data-anchor-id="set_env_variables">set_env_variables</h3>
<blockquote class="blockquote">
<pre><code> set_env_variables (config_path:str, overide_env_vars:bool=True)</code></pre>
</blockquote>
<p>*Load dot env sets environmental values from a file, if the value already exists it will not be overwritten unless override is set to True. If we have multiple .env files then we need to apply the one which we want to take precedence last with overide.</p>
<p>Order of precedence: .env file &gt; environment variables &gt; default values When developing, making a change to the config will not be reflected until the environment is restarted</p>
<p>Set the env vars first, this is needed for the card.yaml to replace ENV variables NOTE: You need to adjust PROJECT_NAME to your package name for this to work, the exception is only for dev purposes This here checks if your package is installed, such as through pypi or through pip install -e [.dev] for development. If it is then it’ll go there and use the config files there as your default values.</p>
<p>Args: config_path (str): path to the config file overide_env_vars (bool): if True, will overwrite existing env variables</p>
<p>Returns: bool: True if successful, False otherwise*</p>
</section>
<section id="get-config" class="level3">
<h3 class="anchored" data-anchor-id="get-config">get config</h3>
<p>When you run this function, assuming things are set up properly, you end up with a dict that matches your <code>.yaml</code> file. This file will have all the inputs for the package and settings of your program.</p>
<p>To do this it will use a <code>.env</code> config file, which has an associated yaml file defined with <code>CORE_YAML_CONFIG_FILE</code> in the <code>.env</code> file. And then use the <code>.env</code> file to load values into the associated <code>.yaml</code> file.</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L153" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_config" class="level3">
<h3 class="anchored" data-anchor-id="get_config">get_config</h3>
<blockquote class="blockquote">
<pre><code> get_config (config_path:str=None, overide_env_vars:bool=True)</code></pre>
</blockquote>
<p>*Load the config.env from the config path, the config.env should reference the config.yaml file, which will be loaded and returned as a dictionary. The config.yaml file should be in the same directory as the config.env file.</p>
<p>Args: config_path (str): The path to the config.env file overide_env_vars (bool): If the env vars should be overriden by the config.yaml file</p>
<p>Returns: dict: The config.yaml file as a dictionary, it’ll also replace any ENV variables in the yaml file*</p>
</section>
<section id="variables" class="level3">
<h3 class="anchored" data-anchor-id="variables">Variables</h3>
<p>All the user input variables and machine adjustable variables should be in your config, which is a dict. Reference config.default.yaml for how to access your variables. Also note that with python dicts you can use <code>dict_variable.get("variable", default_value)</code> to ensure that you don’t get a key error if the variable is not set.</p>
</section>
<section id="show-project-env-vars" class="level3">
<h3 class="anchored" data-anchor-id="show-project-env-vars">show project env vars</h3>
<p>A helper function intended to only be used with debugging. It shows all your project specific environmental variables.</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L185" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="show_project_env_vars" class="level3">
<h3 class="anchored" data-anchor-id="show_project_env_vars">show_project_env_vars</h3>
<blockquote class="blockquote">
<pre><code> show_project_env_vars (config:dict)</code></pre>
</blockquote>
<p>*Show all the project environment variables, this is useful for debugging and seeing what is being set</p>
<p>Args: config (dict): The dictionary of all the environment variables</p>
<p>Returns: None*</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L202" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tool_is_present" class="level3">
<h3 class="anchored" data-anchor-id="tool_is_present">tool_is_present</h3>
<blockquote class="blockquote">
<pre><code> tool_is_present (tool_name:str)</code></pre>
</blockquote>
<p>*Check if a tool is present in the current environment</p>
<p>Args: tool_name (str): The name of the tool to check</p>
<p>Returns: bool: True if the tool is present, False otherwise*</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L216" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tools_are_present" class="level3">
<h3 class="anchored" data-anchor-id="tools_are_present">tools_are_present</h3>
<blockquote class="blockquote">
<pre><code> tools_are_present (tool_names:list)</code></pre>
</blockquote>
<p>*Check if all tools are present in the current environment</p>
<p>Args: tool_names (list): A list of tools to check</p>
<p>Returns: bool: True if all tools are present, False otherwise*</p>
</section>
</section>
<section id="get_samplesheet" class="level2">
<h2 class="anchored" data-anchor-id="get_samplesheet">get_samplesheet</h2>
<p>This function is to unify the way we work with sample_sheet’s which is for us a file with a table of values, typically samples for batch processing. We want to approach doing it this way so all programs have batch processing in mind and working with the same data structure.</p>
<p>To make use of it we have a small sample_sheet yaml object which looks like</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_sheet</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">path</span><span class="kw">:</span><span class="at"> path/to/sample_sheet.tsv</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">delimiter</span><span class="kw">:</span><span class="at"> </span><span class="st">'\t'</span><span class="co"> # Optional, will assume , for csv and \t otherwises</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">header</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="co"> # Optional, 0 indicates first row is header, None indicates no header</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">columns</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">'column1'</span><span class="kw">,</span><span class="at"> </span><span class="st">'column2'</span><span class="kw">,</span><span class="at"> </span><span class="st">'column3'</span><span class="kw">]</span><span class="co"> # Optional, if not provided all columns will be used</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Make sure to add that to your relevant section in your config (can be multiple times if you’re working with different sheets or different columns), then call the function on this object and it’ll either mention somethings wrong or return a pandas dataframe with the columns of interest.</p>
<p>This is an example of a common sample_sheet we work with. We will ingest the hash at the beginning so it doesn’t affect column naming. Extra empty rows at the end are also stripped.</p>
<pre class="tsv"><code>#sample_id  file_path   metadata1   metadata2
Sample1 /path/to/sample1.fasta  value1  option1
Sample2 /path/to/sample2.fasta  value2  option2
Sample3 /path/to/sample3.fasta  value3  option1
Sample4 /path/to/sample4.fasta  value1  option2
Sample5 /path/to/sample5.fasta  value2  option1</code></pre>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L264" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_samplesheet-1" class="level3">
<h3 class="anchored" data-anchor-id="get_samplesheet-1">get_samplesheet</h3>
<blockquote class="blockquote">
<pre><code> get_samplesheet (samplesheet_config:__main__.SamplesheetConfig)</code></pre>
</blockquote>
<p>*Load the sample sheet into a pandas dataframe If columns is not None then it will only load those columns If the sample sheet is a csv then it will load it as a csv, otherwise it will assume it’s a tsv</p>
<p>Expected samplesheet_config: sample_sheet: path: path/to/sample_sheet.tsv delimiter: ’ ’ # Optional, will assume , for csv and otherwises header: 0 # Optional, 0 indicates first row is header, None indicates no header columns: [‘column1’, ‘column2’, ‘column3’] # Optional, if not provided all columns will be used</p>
<p>Example sample sheet: #sample_id file_path metadata1 metadata2 Sample1 /path/to/sample1.fasta value1 option1 Sample2 /path/to/sample2.fasta value2 option2 Sample3 /path/to/sample3.fasta value3 option1 Sample4 /path/to/sample4.fasta value1 option2 Sample5 /path/to/sample5.fasta value2 option1</p>
<p>Args: samplesheet_config (SamplesheetConfig): The configuration for loading the sample sheet</p>
<p>Returns: pd.DataFrame: The sample sheet as a pandas dataframe*</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L239" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="samplesheetconfig" class="level3">
<h3 class="anchored" data-anchor-id="samplesheetconfig">SamplesheetConfig</h3>
<blockquote class="blockquote">
<pre><code> SamplesheetConfig (config:dict[str,typing.Any])</code></pre>
</blockquote>
<p>*Configuration class for loading a sample sheet into a pandas dataframe</p>
<p>Extends: BaseModel*</p>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>config_dict <span class="op">=</span> {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"path"</span>: <span class="ss">f"</span><span class="sc">{</span>PROJECT_DIR<span class="sc">}</span><span class="ss">/input/example_samplesheet.tsv"</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"delimiter"</span>: <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"columns"</span>: <span class="va">None</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>samplesheet_config <span class="op">=</span> SamplesheetConfig(config_dict)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(get_samplesheet(samplesheet_config))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The functions below are <strong>not</strong> tempalted and you should adjust this with your own code. It’s included as an example of how to code some functions with associated tests and how to make it work on the command line. It is best to code by creating a new workbook and then importing the functions of this into that one.</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L322" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hello_world" class="level3">
<h3 class="anchored" data-anchor-id="hello_world">hello_world</h3>
<blockquote class="blockquote">
<pre><code> hello_world (name:str='Not given')</code></pre>
</blockquote>
<p><em>A simple function that returns a hello world message with a name, for testing purposes</em></p>
<p>This here is a a test as part of fastcore.test, all fastcore tests will be automatically run when doing nbdev_test as well as through github actions.</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>test.test_eq(<span class="st">"Hello World! My name is Kim"</span>, hello_world(<span class="st">"Kim"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <span class="citation" data-cites="call_parse">@call_parse</span> will, with the settings.ini entry way, automatically transform your function into a command line tool. Comments of the functions will appear for help messages and the initial docstring will appear in the help as well. You can also define defaults for the arguments and should define a typehint to control inputs. The function will likely have to resolve variables with ENV vars and config files. The recommended way to do this is to assume variables passed here are a higher priority.</p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/pingme_class.py#L270" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="cli" class="level3">
<h3 class="anchored" data-anchor-id="cli">cli</h3>
<blockquote class="blockquote">
<pre><code> cli (name:str, config_file:str=None)</code></pre>
</blockquote>
<p>*This will print Hello World! with your name</p>
<p>Args: name (str): Your name config_file (str): The path to the config file, if not provided it will use the default config file*</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>name</td>
<td>str</td>
<td></td>
<td>Your name</td>
</tr>
<tr class="even">
<td>config_file</td>
<td>str</td>
<td>None</td>
<td>config file to set env vars from</td>
</tr>
</tbody>
</table>
<p>Test the function with potentially variable input to confirm output</p>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>test.test_eq(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hello World! My name is Kim"</span>, hello_world(config[<span class="st">"example"</span>][<span class="st">"input"</span>][<span class="st">"name"</span>])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>test.test_eq(<span class="va">None</span>, cli(<span class="st">"Kim"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L376" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="execute_job" class="level3">
<h3 class="anchored" data-anchor-id="execute_job">execute_job</h3>
<blockquote class="blockquote">
<pre><code> execute_job (script_path, use_slurm=False, slurm_params=None)</code></pre>
</blockquote>
<p><em>Executes a bash script either locally (bash) or via Slurm.</em></p>
<hr>
<p><a href="https://github.com/$GIT_USER_NAME/pingme/blob/main/pingme/core.py#L352" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="create_bash_script" class="level3">
<h3 class="anchored" data-anchor-id="create_bash_script">create_bash_script</h3>
<blockquote class="blockquote">
<pre><code> create_bash_script (script_path, script_content, slurm_params=None)</code></pre>
</blockquote>
<p><em>Create a bash script with the given content.</em></p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> submit_job(script_path, dependency<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Submit a Slurm job with optional dependencies.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">    script_path (str): Path to the script to submit.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">    dependency (str): Job ID to depend on.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">    str: Job ID if successful, None otherwise.</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    command <span class="op">=</span> [<span class="st">"sbatch"</span>]</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dependency:</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        command.append(<span class="ss">f"--dependency=afterok:</span><span class="sc">{</span>dependency<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    command.append(script_path)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> subprocess.run(command, capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        job_id <span class="op">=</span> result.stdout.strip().split()[<span class="op">-</span><span class="dv">1</span>]  <span class="co"># Extract job ID from output</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Job submitted: </span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> job_id</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error submitting job: </span><span class="sc">{</span>result<span class="sc">.</span>stderr<span class="sc">.</span>strip()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> submit_workflow(scripts) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Submit a series of scripts with dependencies.</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">    scripts: List of script paths to submit, they will be submitted in order with previous job as a dependency.</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">    str: Job ID of the last submitted job if successful, None otherwise.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    previous_job_id <span class="op">=</span> <span class="va">None</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> script <span class="kw">in</span> scripts:</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        dependency <span class="op">=</span> (  <span class="co"># Construct the dependency argument if there is a previous job</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"--dependency=afterok:</span><span class="sc">{</span>previous_job_id<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> previous_job_id <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        previous_job_id <span class="op">=</span> submit_job(script, dependency)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> previous_job_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/$GIT_USER_NAME\.github\.io\/pingme");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/$GIT_USER_NAME/pingme/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>